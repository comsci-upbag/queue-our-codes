import { useEffect, useState } from "react"
import AlertBox from "./AlertBox"


import styles from "@/styles/Maze.module.css"
import { answerBoxVisibilityState } from "@/globals/states"
import { useSetRecoilState } from "recoil"

// 3d array of the maze
const maze = [
  [
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['ğŸ˜º', 'ğŸªœ', 'â–ˆ', 'Z', 'W', 'V', 'H', 'K', 'â–ˆ', 'ğŸªœ', 'D', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'R', 'N', 'ğŸªœ', 'â–ˆ', 'O', 'â–ˆ'],
    ['â–ˆ', 'Y', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'C', 'â–ˆ', 'L', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'H', 'â–ˆ', 'K', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'M', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'A', 'ğŸªœ', 'â–ˆ', 'V', 'â–ˆ', 'S', 'â–ˆ', 'W', 'K', 'P', 'â–ˆ', 'O', 'R', 'S', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'T', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'W', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'B', 'â–ˆ', 'W', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'X', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'M', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'E', 'R', 'ğŸªœ', 'â–ˆ', 'Y', 'P', 'D', 'S', 'T', 'S', 'A', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'H', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'L', 'â–ˆ', 'P', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'A', 'J', 'â–ˆ', 'B', 'â–ˆ', 'T', 'â–ˆ', 'W', 'â–ˆ', 'D', 'â–ˆ', 'R', 'K', 'P', 'â–ˆ', 'Q', 'U', 'H', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'W', 'â–ˆ', 'J', 'â–ˆ', 'H', 'â–ˆ', 'O', 'â–ˆ', 'D', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'D', 'â–ˆ', 'O', 'â–ˆ'],
    ['â–ˆ', 'X', 'G', 'V', 'T', 'E', 'T', 'I', 'â–ˆ', 'S', 'V', 'J', 'G', 'H', 'J', 'O', 'U', 'W', 'â–ˆ', 'E', 'â–ˆ'],
    ['â–ˆ', 'A', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'V', 'â–ˆ', 'X', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'S', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'Q', 'â–ˆ', 'L', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'E', 'J', 'K', 'L', 'M', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'S', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'S', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'W', 'â–ˆ', 'X', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'T', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'R', 'F', 'Z', 'P', 'ğŸªœ', 'N', 'ğŸªœ', 'Z', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ'],
    ['â–ˆ', 'Y', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'Z', 'L', 'L', 'ğŸªœ', 'â–ˆ', 'C', 'M', 'ğŸªœ', 'â–ˆ', 'N', 'W', 'I', 'H', 'G', 'â–ˆ', 'D', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'C', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'M', 'â–ˆ', 'B', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'S', 'â–ˆ'],
    ['â–ˆ', 'F', 'P', 'U', 'R', 'V', 'Z', 'J', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'E', 'â–ˆ', 'I', 'â–ˆ', 'Z', 'U', 'R', 'E', 'A', 'â–ˆ'],
    ['â–ˆ', 'C', 'â–ˆ', 'N', 'â–ˆ', 'Q', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'I', 'â–ˆ', 'W', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'T', 'â–ˆ'],
    ['â–ˆ', 'N', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'C', 'P', 'J', 'S', 'F', 'â–ˆ', 'S', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'R', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
  ],
  [
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'â–ˆ', 'L', 'J', 'N', 'â–ˆ', 'Q', 'T', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'X', 'ğŸªœ', 'â–ˆ', 'M', 'â–ˆ', 'ğŸªœ', 'D', 'R', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'K', 'â–ˆ', 'O', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'W', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'B', 'F', 'â–ˆ', 'C', 'S', 'R', 'G', 'L', 'â–ˆ', 'D', 'â–ˆ', 'J', 'Z', 'ğŸªœ', 'â–ˆ', 'M', 'â–ˆ'],
    ['â–ˆ', 'B', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'C', 'â–ˆ', 'N', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'I', 'â–ˆ', 'P', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'U', 'ğŸªœ', 'Z', 'ğŸªœ', 'T', 'ğŸªœ', 'X', 'R', 'â–ˆ', 'ğŸªœ', 'U', 'A', 'â–ˆ', 'D', 'G', 'Q', 'L', 'G', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'K', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'Y', 'F', 'I', 'T', 'Z', 'N', 'â–ˆ', 'W', 'â–ˆ', 'P', 'â–ˆ', 'Q', 'E', 'A', 'â–ˆ', 'H', 'M', 'R', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'D', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'O', 'â–ˆ', 'B', 'â–ˆ', 'Y', 'â–ˆ', 'T', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'X', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'Q', 'W', 'Z', 'N', 'C', 'â–ˆ', 'V', 'â–ˆ', 'N', 'â–ˆ', 'I', 'â–ˆ', 'K', 'J', 'H', 'Y', 'U', 'â–ˆ', 'P', 'â–ˆ'],
    ['â–ˆ', 'F', 'â–ˆ', 'O', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'X', 'â–ˆ', 'Y', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'Z', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'W', 'â–ˆ'],
    ['â–ˆ', 'N', 'â–ˆ', 'A', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'E', 'Q', 'Q', 'A', 'L', 'E', 'ğŸªœ', 'F', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'T', 'ğŸªœ', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'G', 'â–ˆ', 'B', 'â–ˆ', 'S', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'T', 'â–ˆ', 'W', 'S', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'R', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'V', 'â–ˆ', 'W', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'C', 'â–ˆ', 'U', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'Z', 'â–ˆ'],
    ['â–ˆ', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'H', 'â–ˆ', 'ğŸªœ', 'I', 'O', 'â–ˆ', 'ğŸªœ', 'â–ˆ', 'P', 'â–ˆ', 'O', 'T', 'R', 'â–ˆ', 'X', 'â–ˆ'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'P', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'O', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'S', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'B', 'â–ˆ'],
    ['â–ˆ', 'Q', 'E', 'R', 'â–ˆ', 'M', 'A', 'D', 'Y', 'ğŸªœ', 'T', 'P', 'â–ˆ', 'V', 'T', 'A', 'â–ˆ', 'U', 'S', 'V', 'â–ˆ'],
    ['â–ˆ', 'T', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'N', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'D', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
    ['â–ˆ', 'Y', 'V', 'ğŸªœ', 'E', 'R', 'â–ˆ', 'P', 'X', 'Y', 'â–ˆ', 'Z', 'M', 'ğŸªœ', 'O', 'ğŸªœ', 'â–ˆ', 'ğŸªœ', 'A', 'ğŸªœ', 'ğŸ˜¼'],
    ['â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ', 'â–ˆ'],
  ],
]

let visited: string[] = ['0-1-0']

export default function Maze() {

  const setShowAnswerBox = useSetRecoilState(answerBoxVisibilityState)
  const [startGame, setStartGame] = useState(false)
  const [x, setX] = useState(0)
  const [y, setY] = useState(1)
  const [z, setZ] = useState(0)
  const [isPlayerAtEnd, setIsPlayerAtEnd] = useState(false)

  function Controls() {
    return <>
      <div className={styles.Controls}>
        <span />
        <button onClick={() => {
          if ((y - 1) >= 0 && maze[z][y - 1][x] !== 'â–ˆ') {
            setY(y - 1);
            visited.push(z + "-" + y + "-" + x)
          }
        }}>ğŸ”¼</button>
        <span />
        <button onClick={() => {
          if ((x - 1) >= 0 && maze[z][y][x - 1] !== 'â–ˆ') {
            setX(x - 1)
            visited.push(z + "-" + y + "-" + x)
          }
        }}>â—€ï¸</button>
        <button onClick={() => {
          if (maze[z][y][x] === 'ğŸªœ') {
            z === 0 ? setZ(1) : setZ(0)
            visited.push(z + "-" + y + "-" + x)
          }
        }}>â­•ï¸</button>
        <button onClick={() => {
          if ((x + 1) < maze[z][y].length && maze[z][y][x + 1] !== 'â–ˆ') {
            setX(x + 1)
            visited.push(z + "-" + y + "-" + x)
          }
        }}>â–¶ï¸</button>
        <span />
        <button onClick={() => {
          if ((y + 1) < maze[z].length && maze[z][y + 1][x] !== 'â–ˆ') {
            setY(y + 1)
            visited.push(z + "-" + y + "-" + x)
          }
        }}>ğŸ”½</button>
        <span />
      </div>
    </>
  }

  useEffect(() => {
    for (let i = 0; i < visited.length; i++) {
      document.getElementById(visited[i])?.classList.add(styles.Visited)
    }
    if (maze[z][y][x] === 'ğŸ˜¼') {
      setIsPlayerAtEnd(true)
    }
  }, [x, y, z])

  useEffect(() => {
    if (isPlayerAtEnd) {
      setShowAnswerBox(true)
    }
  }, [isPlayerAtEnd])

  return <div className={styles.Container}>
    <AlertBox showWhen={isPlayerAtEnd} title={"You've reached the end!"} message={"Now that you've reached the end, keep it at your prime as you are now on your own."} type="info" show={setIsPlayerAtEnd} />

    {startGame ? <>
      <div className={styles.MazeContainer} key={String(z + " ")}>
        {maze[z].map((row, i) => {
          return <div key={String(z + " " + i)} className={styles.Maze}>
            {row.map((cell, j) => {
              if (i === y && j === x) {
                return <div id={z + "-" + i + "-" + j} key={j} className={styles.Visited}>ğŸ‘¤</div>
              }
              if (cell === 'â–ˆ') {
                return <div key={j} style={{
                  background: 'black',
                  width: "100%",
                }}></div>
              }
              return <div key={String(z + " " + i + " " + j)} id={z + "-" + i + "-" + j}>{cell}</div>
            })}
          </div>
        })}
      </div>
      <Controls />
    </> : <>
      <button className={styles.StartButton} onClick={() => setStartGame(true)}>Start Maze</button>
    </>
    }
  </div>
}
